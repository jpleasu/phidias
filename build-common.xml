<?xml version="1.0"?>
<!DOCTYPE project>

<project name="build-commmon">
	<property environment="env" />

	<property file="build.${user.name}.properties" />
	<property file="build.properties" />

	<tstamp>
		<format property="current.time" pattern="yyMMddhhmmss" />
	</tstamp>

	<path id="lib.classpath">
		<fileset dir="lib" includes="*.jar" />
	</path>

	<path id="bundle.classpath">
		<path refid="lib.classpath" />
		<path path="classes" />
		<path path="test-classes" />
	</path>

	<taskdef classpathref="lib.classpath" resource="aQute/bnd/ant/taskdef.properties" />

	<target name="clean-bundle">
		<delete dir="classes" />
		<delete file="${ant.project.name}.jar" />
	</target>

	<target name="compile-bundle">
		<mkdir dir="classes" />

		<copy todir="classes">
			<fileset dir="src" excludes="**/*.java" />
		</copy>

		<javac
			classpathref="bundle.classpath"
			compiler="${javac.compiler}"
			debug="${javac.debug}"
			deprecation="${javac.deprecation}"
			destdir="classes"
			encoding="${javac.encoding}"
			includeAntRuntime="false"
			nowarn="${javac.nowarn}"
			srcdir="src"
		/>
	</target>

	<target name="jar-bundle" depends="clean-bundle,compile-bundle">
		<bnd
			classpath="classes"
			eclipse="false"
			exceptions="true"
			failok="false"
			files="bnd.bnd"
			output="."
			sourcepath="src"
		/>
	</target>
</project>